{% extends 'base.html.twig' %}

{% block title %}Hello AccueilController!
{% endblock %}
{% block search %}
<p>recherche</p>
{% endblock %}
{% block body %}

	{% for message in app.flashes('success') %}
        <div class="alert alert-success d-flex align-items-center" role="alert">
            <i class="bi bi-check-circle me-2 text-success"></i>
            <div class="text-success">
                {{ message }}
            </div>
        </div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger d-flex align-items-center" role="alert">
            <i class="bi bi-x-circle me-2 text-danger"></i>
            <div class="text-danger">
                {{ message }}
            </div>
        </div>
    {% endfor %}

	
	{% if is_granted('ROLE_EXPERT') %}
	<div class="d-flex flex-column w-100 mb-5">
		<h5 class="fw-normal mb-3">
			Statistique
		</h5>
		<div class="table-responsive rounded-custom bg-white shadow-custom text-start">
			{% set nbOp = 0 %}
			{% set nbOpLibre = 0 %}
			{% set nbOpReserve = 0 %}
			{% set nbOpTermine = 0 %}
			{% set CA = 0 %}

			{% for operation in operations %}
				{% set nbOp = nbOp + 1 %}
				{% if operation.statutOperation == "Libre" %}
					{% set nbOpLibre = nbOpLibre + 1 %}
				{% elseif operation.statutOperation == "En cours" %}
					{% set nbOpReserve = nbOpReserve + 1 %}
				{% elseif operation.statutOperation == "Terminée" %}
					{% set nbOpTermine = nbOpTermine + 1 %}
					{% set CA = CA + operation.typeOperation.prix %}
				{% endif %}
			{% endfor %}

			{% if nbOp != 0 %}
				{% set PctOpLibre = nbOpLibre / nbOp * 100 %}
				{% set PctOpReserve = nbOpReserve / nbOp * 100 %}
				{% set PctOpTermine = nbOpTermine / nbOp * 100 %}
			<div>Nombre total d'opérations : {{nbOp}}  </div>
			<div>
				Nombre d'opérations Libres : {{nbOpLibre}} --> {{PctOpLibre|number_format(2, '.', ',')}}% 
			</div>
			<div>Nombre d'opération réservées : {{nbOpReserve}} --> {{PctOpReserve|number_format(2, '.', ',')}}%</div>
			<div>Nombre d'opération terminées : {{nbOpTermine}} --> {{PctOpTermine|number_format(2, '.', ',')}}%</div>
			<div>Chiffre d'Affaire (opérations terminées) :  {{CA|number_format(0, '.', ' ')}}€</div>
			{% else %}
			<div>Il n'y a pas d'opérations</div>
			{% endif %}
			

			
			
		</div>
	</div>

	<div class="d-flex flex-column w-100 mb-5">
		<h5 class="fw-normal mb-3">
			Liste des Utilisateurs
		</h5>
		<div class="table-responsive rounded-custom bg-white shadow-custom text-center">
			<table class="table table-hover table-borderless text-dark">
				<thead >
					<tr>
						<th scope="col" style="width: 54px;">Id</th>
						<th scope="col" style="width: 90px;">Photo</th>
						<th scope="col">Rôle</th>
						<th scope="col">Nom</th>
						<th scope="col">Prénom</th>
						<th scope="col">Téléphone</th>
						<th scope="col">Adresse</th>
						<th scope="col">Mail</th>
						<th scope="col" style="width: 90px;">Actions</th>
					</tr>
					<tr>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col"><button type="button" class="btn bg-secondary p-1 rounded-custom text-secondary bg-opacity-10" data-bs-toggle="modal" data-bs-target="#utilisateurAjout">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
										<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
										</svg>
                                		</button></th>
						

							   <!-- Modal ajout-->
						<div class="modal fade" id="utilisateurAjout" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content border-0">
								<div class="modal-header d-flex flex-row justify-content-between align-items-start">
									<div class="d-flex flex-column">
										<h5 class="modal-title text-secondary" id="staticBackdropLabel">Création d'un nouvel utilisateur</h5>
									</div>
									<div class="d-flex flex-row align-items-start h-100">
										<button type="button" class="btn-close" id="example" data-bs-dismiss="modal" aria-label="Close" data-bs-toggle="tooltip" data-bs-placement="right" title="Tooltip on right"></button>
									</div>
									
								</div>
								<div class="modal-body d-flex flex-column ">
									<h5>Details</h5>
									{{ include('registration/register.html.twig', {'button_label': 'Créer'}) }}
									{# {{ include('client/new.html.twig') }} #}
								</div>
								</div>
							</div>
							</div>
					</tr>
				</thead>
				<tbody>
				{% for utilisateur in utilisateurs %}
					<tr class="align-middle">
						<td scope="row">#{{ utilisateur.id }}</td>
						<td><img src="https://avatars.dicebear.com/api/identicon/{{ utilisateur.nom }}.{{ utilisateur.prenom }}.svg" height="32" width="32" alt="..." class="border border-secondary border-2 rounded-2 bg-light"></td>
						<td>{{ utilisateur.role }}</td>
						<td>{{ utilisateur.nom }}</td>
						<td>{{ utilisateur.prenom }}</td>
						<td>{{ utilisateur.telephone }}</td>
						<td>{{ utilisateur.adresse }}</td>
						<td>{{ utilisateur.email }}</td>
						<td class="d-flex flex-row justify-content-evenly w-100">
							<a href="{{ path('utilisateur_edit', {'id': utilisateur.id}) }}">
								<i class="bi bi-pen"></i>
							</a>
							{{ include('utilisateur/_delete_form.html.twig', {'_url': 'accueil'}) }}</td>
					</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>
	</div>

	<div class="d-flex flex-column w-100mb-5">
		<h5 class="fw-normal mb-3">
			Liste des Clients
		</h5>
        <div class="table-responsive rounded-custom bg-white shadow-custom text-center">
			
			<table class="table table-hover table-borderless text-dark">
				<thead >
					<tr>
						<th scope="col" style="width: 54px;">Id</th>
						<th scope="col" style="width: 90px;">Photo</th>
						<th scope="col">Nom</th>
						<th scope="col">Prénom</th>
						<th scope="col">Téléphone</th>
						<th scope="col">Adresse</th>
						<th scope="col">Mail</th>
						<th scope="col" style="width: 90px;">Actions</th>
					</tr>
					<tr>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col" class="opacity-25">#</th>
						<th scope="col"><button type="button" class="btn bg-secondary p-1 rounded-custom text-secondary bg-opacity-10" data-bs-toggle="modal" data-bs-target="#clientAjout">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
										<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
										</svg>
                                		</button></th>
						
							   <!-- Modal ajout-->
						<div class="modal fade" id="clientAjout" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content border-0">
								<div class="modal-header d-flex flex-row justify-content-between align-items-start">
									<div class="d-flex flex-column">
										<h5 class="modal-title text-secondary" id="staticBackdropLabel">Création d'un nouveau client</h5>
									</div>
									<div class="d-flex flex-row align-items-start h-100">
										<button type="button" class="btn-close" id="example" data-bs-dismiss="modal" aria-label="Close" data-bs-toggle="tooltip" data-bs-placement="right" title="Tooltip on right"></button>
									</div>
									
								</div>
								<div class="modal-body d-flex flex-column ">
									<h5>Details</h5>
									{{ include('client/_form.html.twig', {'button_label': 'Créer'}) }}
									{# {{ include('client/new.html.twig') }} #}
								</div>
								</div>
							</div>
							</div>
					</tr>
				</thead>
				<tbody>
				{% for client in clients %}
					<tr class="align-middle">
						<td scope="row">#{{ client.id }}</td>
						<td><img src="https://avatars.dicebear.com/api/identicon/{{ client.nom }}.{{ client.prenom }}.svg" height="32" width="32" alt="..." class="border border-secondary border-2 rounded-2 bg-light"></td>
						<td>{{ client.nom }}</td>
						<td>{{ client.prenom }}</td>
						<td>{{ client.telephone }}</td>
						<td>{{ client.adresse }}</td>
						<td>{{ client.mail }}</td>
						<td class="d-flex flex-row justify-content-evenly w-100"><a href="{{ path('client_edit', {'id': client.id}) }}"><i class="bi bi-pen"></i></a>{{ include('client/_delete_form.html.twig', {'_url': 'accueil'}) }}</td>
					</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}
{% endblock %}
